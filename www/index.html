<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" dir="rtl">
<head>
 <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" > 
    <script src="cordova.js"></script>    
    <script>
	var lastLa;
	var lastLo;
	document.addEventListener('deviceready', onDeviceReady, false);
	function onDeviceReady() {
		navigator.geolocation.getCurrentPosition(onSuccess, onError);
	};
	
	var onSuccess = function(position) {
		lastLa = position.coords.latitude;
		lastLo = position.coords.longitude;
		alert(lastLa);
	};

	var onError = function(error) {
		alert( 'code: ' + error.code + '\n' + 'message: ' + error.message + '\n');
	};

	var onNewPoint = function(position) {
		var curla = position.coords.latitude;
		var curlo = position.coords.longitude;
		alert(curla);
		
		alert(calcTheDistance(curla, curlo));

		lastLa = curla;
		lastLo = curlo;
	};

	function toRadians(num) {
		return num * Math.PI / 180; 
	};

	function calcTheDistance(lati1, long1) {
	alert('calc');
	    var r = 6371000; //metres
	    var joschLat = lastLa;
	    var joschLon = LastLo;
	    var la1 = lati1;
	    var la2 = joschLat;
	    alert('rd1');
	    var lat1 = toRadians(lati1);
	    alert('rd2');
	    var lat2 = toRadians(joschLat);
	    var lo1 = long1;
	    var lo2 = joschLon;
	    var la2minla1 = toRadians(la2-la1);
	    var lo2minlo1 = toRadians(lo2-lo1);
		    alert('rd3');
	    var cal = Math.sin(la2minla1 / 2) * Math.sin(la2minla1 / 2) +
	            Math.cos(lat1) * Math.cos(lat2) *
	            Math.sin(lo2minlo1/2) * Math.sin(lo2minlo1/2);
	    var c = 2* Math.atan2(Math.sqrt(cal), Math.sqrt(1-cal));
	
	    var d = r * c;
	    return Math.round(d);
	};

	function calcdistance() {
		navigator.geolocation.getCurrentPosition(onNewPoint, onError);
		
	}
</script>
</head>
<body id="body" onload="init();" dir="rtl">
   <center>
	<input type="button" value="מרחק מהקודם" onclick='calcdistance();'/>
    </center>
</body>
</html>